---
title: Daily
layout: null
permalink: /daily/
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>朝闻道</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    /* Animated gradient background */
    body {
      font-family: 'Roboto', sans-serif;
      background: #F5F5F7;
      background-size: 400% 400%;
      animation: gradientAnimation 15s ease infinite;
      min-height: 100vh;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .container {
      width: 90%;
      max-width: 800px;
      padding: 2rem;
      box-sizing: border-box;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeIn 1s ease forwards;
      flex-wrap: wrap;
    }
    
    .header > .date,
    .header > .number {
      flex: 0 0 auto;
    }
    
    .date-picker-container {
      flex: 1 1 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
    }
    
    .date, .number { font-size: 1.2rem; color: #4a5568; }
    
    .date-picker-input {
      max-width: 150px;
      width: 50%;
      border: 2px solid #4299e1;
      border-radius: 8px;
      background: transparent;
      color: #4299e1;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.3s ease;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    
    .date-picker-input:hover {
      background: rgba(66, 153, 225, 0.1);
      transform: scale(1.05);
    }
    
    .date-picker-input:disabled {
      background: #a0aec0;
      cursor: not-allowed;
      transform: none;
    }
    
    .quote-card {
      background: #fff;
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      transition: opacity 0.3s ease;
    }
    
    .quote-content { line-height: 1.8; } /* Increased line-height for Pinyin */
    .chinese-text { font-family: 'KaiTi', '楷体', 'STKaiti', serif; font-size: 1.8rem; margin-bottom: 1.5rem; color: #333; }
    .english-text { font-size: 1.3rem; color: #4a5568; margin: 1.5rem 0; font-style: italic; }
    .author { text-align: right; color: #718096; font-style: italic; }

    /* New Style for Pinyin text */
    rt {
      font-size: 0.9rem;
      color: #6b7280;
      font-family: 'Roboto', sans-serif;
    }

    hr { border: 0; height: 1px; background: #e2e8f0; margin: 1.5rem 0; }
    
    .navigation { display: flex; justify-content: center; gap: 1rem; margin-top: 2rem; }
    
    .nav-btn {
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 980px;
      background: rgb(0, 113, 227);
      color: #fff;
      cursor: pointer;
      transition: transform 0.2s ease, background 0.3s ease;
      outline: none;
      width: 7rem;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      text-align: center;
      font-size: 14px;
      height: 40px;
    }
    
    .nav-btn:hover { background: #0076DF; transform: scale(1.05); }
    .nav-btn:disabled { background: #a0aec0; cursor: not-allowed; transform: none; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @media (max-width: 900px) {
      .chinese-text { font-size: 1.4rem; }
      .english-text { font-size: 1.2rem; }
      .date, .number { font-size: 1rem; }
      .nav-btn { width: 6rem; }
      .date-picker-input { max-width: 120px; }
    }
    
    @media (max-width: 600px) {
      #current-date { display: none; }
      .date-picker-container { justify-content: flex-start; }
      .quote-card { max-width: 95%; padding: 1.5rem; }
    }
  </style>
  <!-- Include SheetJS library from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- GoatCounter tracking (sends the hit) -->
  {% include analytics/goatcounter.html %}

  
</head>
<body>
  <div class="container">
    <div class="header">
      <div id="current-date" class="date"></div>
      <div class="date-picker-container">
        <input type="date" id="date-picker" class="date-picker-input">
      </div>
      <div id="quote-number" class="number"></div>
    </div>

    <div class="quote-card" id="quote-card">
      <div class="quote-content">
        <p id="chinese-quote" class="chinese-text"></p>
        <p id="chinese-author" class="author"></p>
        <hr />
        <p id="english-quote" class="english-text"></p>
        <p id="english-author" class="author"></p>
      </div>
    </div>

    <div class="navigation">
      <button id="prev-btn" class="nav-btn">Previous</button>
      <select id="csv-select" class="nav-btn"></select>
      <button id="next-btn" class="nav-btn">Next</button>
    </div>

    <div style="font-size: 0.9rem; color: #111111; margin-top: 1rem;">
      <span>
        <em id="pageviews" style="font-style: normal; font-weight: bold; color: #111111;">
          Loading…
        </em> visitors
      </span>
    </div>
    
  </div>



  <script>
    // --- CONFIGURATION ---
    // Paste the ID of your master Google Sheet here.
    // The sheet must be "Published to the web" for this to work.
    const MASTER_SHEET_ID = '1qPXWt35n3-wdaOVsMccHSFhydNzyiCVBitWt1ReDRBE'; 
    // -------------------

    function getLocalDateString(date) {
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    document.addEventListener('DOMContentLoaded', () => {
      let currentDate;
      let quotes = [];
      let selectedDay = 1;
      let initialized = false;
      let next_btn_lock = false;

      try {
        currentDate = new Date();
      } catch {
        currentDate = new Date(Date.now() + (480 * 60000));
      }
  
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  
      function loadQuotes(sheetId) {
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv`;
        
        fetch(url)
          .then(response => {
            if (!response.ok) {
              throw new Error(`Network response was not ok for sheet ID: ${sheetId}`);
            }
            return response.text();
          })
          .then(csvText => {
            const workbook = XLSX.read(csvText, { type: 'string' });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
            
            // **MODIFIED PART 1: Read the Pinyin column**
            quotes = rows.slice(1).map(row => ({
              'No': row[0],
              'Chinese': row[1],
              'Author_CL': row[2],
              'English': row[3],
              'Author_EL': row[4],
              'Pinyin': row[5] // Read the 6th column for Pinyin
            }));

            if (!initialized) {
              initialize();
              initialized = true;
            } else {
              updateDisplay();
            }
          })
          .catch(error => {
            console.error('Error loading quotes sheet:', error);
            document.getElementById('chinese-quote').textContent = 'Error loading quotes. Please check if the sheet is published to the web.';
            document.getElementById('english-quote').textContent = '';
          });
      }
  
      function populateDropdownFromMasterSheet() {
        if (!MASTER_SHEET_ID || MASTER_SHEET_ID === 'YOUR_MASTER_SHEET_ID_HERE') {
            console.error("Master Sheet ID is not set. Please update the MASTER_SHEET_ID constant.");
            alert("Configuration error: Master Sheet ID is missing.");
            return;
        }

        const url = `https://docs.google.com/spreadsheets/d/${MASTER_SHEET_ID}/export?format=csv`;

        fetch(url)
          .then(response => {
            if (!response.ok) throw new Error('Unable to fetch Master Sheet. Is it published to the web?');
            return response.text();
          })
          .then(csvText => {
            const workbook = XLSX.read(csvText, { type: 'string' });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

            const fileList = rows.slice(1).map(row => ({
              title: row[0],
              id: row[1]
            })).filter(item => item.id);

            if (fileList.length > 0) {
              updateDropdown(fileList);
              loadQuotes(fileList[0].id);
            } else {
              console.error("No valid sheet data found in the master sheet.");
            }
          })
          .catch(err => {
            console.error('Error fetching Master Sheet configuration:', err);
            alert('Failed to load the list of quote sheets. Please check the Master Sheet configuration and ensure it is published.');
          });
      }
  
      function updateDropdown(fileList) {
        const dropdown = document.getElementById('csv-select');
        dropdown.innerHTML = '';
        fileList.forEach(file => {
          const option = document.createElement('option');
          option.value = file.id;
          option.textContent = file.title;
          dropdown.appendChild(option);
        });
      }
  
      document.getElementById('csv-select').addEventListener('change', function() {
        const selectedSheetId = this.value;
        if (selectedSheetId) {
          loadQuotes(selectedSheetId);
        }
      });
  
      function initialize() {
        const year = currentDate.getFullYear();
        const isLeapYear = (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        
        const start = new Date(year, 0, 0);
        const diff = currentDate - start;
        const oneDay = 1000 * 60 * 60 * 24;
        selectedDay = Math.floor(diff / oneDay);
        
        if (!isLeapYear && selectedDay >= 366) selectedDay = 1;
        if (!isLeapYear && selectedDay > 365) selectedDay = 365;
  
        updateDisplay();
        setupNavigation();
  
        const datePicker = document.getElementById('date-picker');
        datePicker.min = `${year}-01-01`;
        if (next_btn_lock) {
          datePicker.max = getLocalDateString(currentDate);
        }
        const displayDate = new Date(year, 0, selectedDay);
        datePicker.value = getLocalDateString(displayDate);
  
        datePicker.addEventListener('change', function(){
          let chosenDate = new Date(this.value);
          if (next_btn_lock && chosenDate > currentDate) {
            chosenDate = currentDate;
            this.value = getLocalDateString(currentDate);
          }
          const startOfYear = new Date(chosenDate.getFullYear(), 0, 0);
          const diff = chosenDate - startOfYear;
          const oneDay = 1000 * 60 * 60 * 24;
          selectedDay = Math.floor(diff / oneDay);
          updateDisplay();
        });
      }
  
      function updateContent() {
        const displayDate = new Date(currentDate.getFullYear(), 0, selectedDay);
        const dateString = `${displayDate.getDate().toString().padStart(2, '0')} ${monthNames[displayDate.getMonth()]} ${displayDate.getFullYear()}, ${dayNames[displayDate.getDay()]}`;
        document.getElementById('current-date').textContent = dateString;
        document.getElementById('quote-number').textContent = `#${selectedDay}`;
  
        const cycleLength = quotes.length;
        if (cycleLength > 0) {
          const index = (selectedDay - 1) % cycleLength;
          let quote = quotes[index];
          if (quote) {
            // **MODIFIED PART 2: Build the Pinyin display using <ruby> tags**
            const chineseQuoteEl = document.getElementById('chinese-quote');
            const chineseText = quote['Chinese'];
            const pinyinText = quote['Pinyin'];

            if (chineseText && pinyinText) {
              const chineseChars = chineseText.split('');
              const pinyinSyllables = pinyinText.split(' ');

              if (chineseChars.length === pinyinSyllables.length) {
                let rubyHTML = '';
                for (let i = 0; i < chineseChars.length; i++) {
                  rubyHTML += `<ruby>${chineseChars[i]}<rt>${pinyinSyllables[i]}</rt></ruby>`;
                }
                chineseQuoteEl.innerHTML = rubyHTML;
              } else {
                chineseQuoteEl.innerHTML = `${pinyinText}<br>${chineseText}`;
              }
            } else {
              chineseQuoteEl.textContent = chineseText || '';
            }
            
            document.getElementById('english-quote').textContent = quote['English'];
            document.getElementById('chinese-author').textContent = `— ${quote['Author_CL']}`;
            document.getElementById('english-author').textContent = `— ${quote['Author_EL']}`;
          }
        }
  
        document.getElementById('date-picker').value = getLocalDateString(displayDate);
        document.getElementById('prev-btn').disabled = selectedDay <= 1;
        document.getElementById('next-btn').disabled = next_btn_lock ? (selectedDay >= getMaxDay()) : false;
      }
  
      function updateDisplay() {
        const quoteCard = document.getElementById('quote-card');
        quoteCard.style.opacity = 0;
        setTimeout(() => {
          updateContent();
          quoteCard.style.opacity = 1;
        }, 300);
      }
  
      function setupNavigation() {
        document.getElementById('prev-btn').addEventListener('click', () => {
          if (selectedDay > 1) {
            selectedDay--;
            updateDisplay();
          }
        });
  
        document.getElementById('next-btn').addEventListener('click', () => {
          if (next_btn_lock) {
            if (selectedDay < getMaxDay()) {
              selectedDay++;
              updateDisplay();
            }
          } else {
            selectedDay++;
            updateDisplay();
          }
        });
      }
  
      function getMaxDay() {
        const startOfYear = new Date(currentDate.getFullYear(), 0, 0);
        const diff = currentDate - startOfYear;
        const oneDay = 1000 * 60 * 60 * 24;
        return Math.floor(diff / oneDay);
      }
  
      populateDropdownFromMasterSheet();
    });

  </script>

  <!-- GoatCounter display (fetches & fills #pageviews) -->
  
  {% include pageviews/goatcounter.html %}
  
</body>
</html>
